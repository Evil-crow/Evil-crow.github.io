<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"><!--<![endif]--> <head> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/github.min.css"> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script> <script>hljs.initHighlightingOnLoad();</script> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <title>my_shell项目文档 &#8211; Road to Coding</title> <meta name="description" content="只要那一抹笑容尚存, 我便心无旁骛"> <meta name="keywords" content=""> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="http://localhost:4000/assets/img/logo.png"> <meta name="twitter:title" content="my_shell项目文档"> <meta name="twitter:description" content="my_shell 项目文档"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="my_shell项目文档"> <meta property="og:description" content="my_shell 项目文档"> <meta property="og:url" content="http://localhost:4000/document-my-shell/"> <meta property="og:site_name" content="Road to Coding"> <meta property="og:image" content="http://localhost:4000/assets/img/logo.png"> <link rel="canonical" href="http://localhost:4000/document-my-shell/"> <link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Road to Coding Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css"> <!-- JS --> <script src="http://localhost:4000/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="http://localhost:4000/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png" /> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /> <!-- Background Image --> <style type="text/css">body {background-image:url(http://localhost:4000/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="http://localhost:4000/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="http://localhost:4000/assets/img/logo.png" alt="Road to Coding photo" class="author-photo"> <h4>Road to Coding</h4> <p>只要那一抹笑容尚存, 我便心无旁骛</p> </li> <li><a href="http://localhost:4000/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="mailto:evilcrow486@gmail.com" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-envelope-square"></i> Email</a> </li> <li> <a href="http://github.com/Evil-crow" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul><!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="http://localhost:4000/posts/">All Posts</a></li> <li><a href="http://localhost:4000/tags/">All Tags</a></li> </ul> </li> </ul><!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn" style="background-color:rgba(255,255,255,0.97);"> <div class="content"> <div class="post-title "> <h1>my_shell项目文档</h1> <h4>22 Sep 2017</h4> <a class="btn zoombtn" href="http://localhost:4000/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <p>在<strong>进程</strong>的相关知识学习完了之后,按小组要求实现了my_shell</p> <p><strong>一个类似与bash shell的命令分析器</strong></p> <p>本篇即是我自己实现的my_shell的项目文档</p> <p>my_shell的源码,已上传至Github,可以<a href="https://github.com/Evil-crow/Linux_C/tree/master/Chapter_VII/Shell">点击这里</a> _ _ _</p> <p>本篇项目文档分为五个部分,可通过点击以下标签进行访问</p> <ul> <li> <p><a href="#1">一,项目需求</a></p> </li> <li> <p><a href="#2">二,设计思路</a></p> </li> <li> <p><a href="#3">三,实现要点</a></p> </li> <li> <p><a href="#4">四,项目演示</a></p> </li> <li> <p><a href="#5">五,存在问题</a></p> </li> <li> <p><a href="#6">六,设计感想</a></p> </li> </ul> <hr /> <h4 id="一项目需求">一.项目需求</h4> <p><strong>1.支持输入输出重定向(&lt; &gt; »)</strong></p> <table> <tbody> <tr> <td>**2.支持管道(</td> <td>)**</td> </tr> </tbody> </table> <p><strong>3.支持shell内置命令(实现cd即可)</strong></p> <p><strong>*4.支持后台运行程序(&amp;)</strong></p> <p><strong>*5.支持tab补全目录文件以及历史记录上下翻(提示:使用readline库)</strong></p> <p><strong>*6.ctrl+c不能中断程序(提示:使用信号)</strong></p> <p><strong>*7.设置环境变量，使程序可以像bash，zsh这种shell一样运行</strong></p> <hr /> <h4 id="二设计思路">二,设计思路</h4> <p>本项目的主题思路是<strong>系统编程+进程操作</strong></p> <p>通过大量的系统编程来实现系统功能,</p> <p>在加上进程操作来实现其他的功能</p> <p>1.<a href="https://github.com/Evil-crow/Linux_C/blob/master/Chapter_VII/Shell/main.c">main.c</a></p> <p><img src="http://img.blog.csdn.net/20170731040746556?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRV92aWxjcm93/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" /></p> <p>2.<a href="https://github.com/Evil-crow/Linux_C/blob/master/Chapter_VII/Shell/print_shell.c">print_shell.c</a></p> <p><img src="http://img.blog.csdn.net/20170731040800867?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRV92aWxjcm93/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" /></p> <p>3.<a href="https://github.com/Evil-crow/Linux_C/blob/master/Chapter_VII/Shell/get_command.c">get_command.c</a></p> <p><img src="http://img.blog.csdn.net/20170731040850458?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRV92aWxjcm93/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" /></p> <p>4.<a href="https://github.com/Evil-crow/Linux_C/blob/master/Chapter_VII/Shell/explain_command.c">explain_command.c</a></p> <p><img src="http://img.blog.csdn.net/20170731040911331?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRV92aWxjcm93/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" /></p> <p>5.<a href="https://github.com/Evil-crow/Linux_C/blob/master/Chapter_VII/Shell/go_command.c">go_command.c</a></p> <p><img src="http://img.blog.csdn.net/20170731040924292?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRV92aWxjcm93/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" /></p> <p>6.<a href="https://github.com/Evil-crow/Linux_C/blob/master/Chapter_VII/Shell/find_command.c">find_command</a></p> <p><img src="http://img.blog.csdn.net/20170731041554550?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRV92aWxjcm93/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" /></p> <p><em>以上的思维导图可以较好的反映功能的实现思路</em></p> <hr /> <h4 id="三实现细节">三,实现细节</h4> <ol> <li> <p>main.c的实现其实就是按照思路进行设计,将下面的函数有效的组织在了一起</p> </li> <li> <p>在print_shell的部分里,主要的环节就是打印shell提示符</p> </li> </ol> <p>为了追求尽可能的真实,我就做了这样的设计</p> <p><strong>“[用户名@主机名 目录名] “</strong></p> <p>其中主要的设计在目录名的打印上,先使用getcwd系统调用获取绝对路径,再进行字符串操作,获取当前目录</p> <p><strong>注意其中最重要的是,根目录/的目录名打印需要特殊处理</strong></p> <p>代码实现:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> if(getcwd(dir,100) == NULL)
 {
     printf("Error!\n");
     exit(0);
 }
 int i,j;
 for(i = 0;dir[i] != '\0';i++)
 {
     if(dir[i] == '/')
     j = i+1;
 }
 if(dir[j+1] == '\0')
 {
     printf("[Crow@Shell /]Σ ");
     return ;
 }
 char Dir[30];
 for(i = 0;i &lt; 100;i++,j++)
 {
     Dir[i] = dir[j];
 }
 Dir[i+1] = '\0';

 printf("[Crow@Shell %s]Σ ",Dir);

</code></pre></div></div> <ol> <li>get_command的功能是进行命令的获取,并且保证其以’\n’结尾</li> </ol> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> i = 0;
 ch = getchar( );
 while(ch != '\n')
 {
     str[i++] = ch;
     ch = getchar( );
 }

 if(i &gt; len)
 {
     printf("Command isn't allowed!\n");
     exit(0);
 }
 if(strcmp(str,"^C") == 0)
 {
     exit(0);
 }

 str[i++] = '\n';
 str[i++] = '\0';

</code></pre></div></div> <ol> <li>expian_command是为执行命令进行准备,对命令参数进行划分获取</li> </ol> <p>下面这段代码很好的演示了使用交叉指针进行移动并获取参数,存入字符串的方法</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> q = p;
 n = 0;
 while(1)
 {
   if(*q != '\n' &amp;&amp; *q != ' ')
   {
      q++;
      n++;
   }
   else
   break;
 }
 strncpy(parameter[count],p,n+1);
 parameter[count][n] = '\0';
 count++;
 p = q;

</code></pre></div></div> <ol> <li>go_command是整个程序的核心,其中进行了参数的判断,并使用switch函数进行功能选取</li> </ol> <p>尤其好用的操作就是在处理父子进程的问题上</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> if(background == 1)
 {
    printf("processid is %d\n",pid);
    exit(0);
 }
 if(waitpid(pid,&amp;status,0) == -1)
 {
     printf("wait chile process failed!");
     exit(0);
 }

</code></pre></div></div> <ol> <li>find_command是在go_command中嵌套的操作,是进行是否为有效命令的判断</li> </ol> <h4 id="四项目演示">四,项目演示</h4> <p>1.实现重定向</p> <p><img src="http://img.blog.csdn.net/20170731041659599?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRV92aWxjcm93/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" /></p> <p><img src="http://img.blog.csdn.net/20170731041731232?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRV92aWxjcm93/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" /></p> <p>2.实现管道</p> <p><img src="http://img.blog.csdn.net/20170731041908583?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRV92aWxjcm93/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" /></p> <p>3.实现shell内置命令(cd为例)</p> <p><img src="http://img.blog.csdn.net/20170731041827969?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRV92aWxjcm93/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" /></p> <p>4.阻断Ctrl-C的信号</p> <p><img src="http://img.blog.csdn.net/20170731041938738?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRV92aWxjcm93/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" /></p> <p>5.实现后台应用程序</p> <p><img src="http://img.blog.csdn.net/20170731042003705?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRV92aWxjcm93/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" /></p> <p>6.设置了环境变量</p> <p><img src="http://img.blog.csdn.net/20170731042049248?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRV92aWxjcm93/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" /></p> <h4 id="五存在问题">五,存在问题</h4> <p>在此次的项目设计中,也存在许多的问题</p> <p>如:</p> <p>1.cd,不能实现直接回家目录的功能,如果使用readline库可能实现会方便一点</p> <p>2.不支持多管道,多重定向,需要继续进行设计</p> <p>3.实现的内置命令不够</p> <p>4.没有成功使用readline库,Tab补全不行,不能上下翻</p> <p>以上只是其中比较明显的问题,自己设计的shell离bash还有很长的一段距离</p> <p>在之后得更新中,会逐步解决这些问题</p> <h4 id="六设计感想">六,设计感想</h4> <p>这次的进程相关设计,使我认识到自己学习的不足</p> <p>进行编程的学习,书本的知识远远是不够的,</p> <p>很多时候,自己上手实践的结果要更可靠得多</p> <p>比如wait函数的调用,在进行了程序设计之后,才对其有明了的认识</p> <p>在管道功能的实现处,真正了解到进程在程序设计中的重要性</p> <p>以后的路还很长,还需要继续进行努力</p> <p>my_shell暂时告一段落,以后有时间会继续进行更新的</p> <div class="entry-meta"> <br> <hr> <span class="entry-tags"></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/document-my-shell/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/document-my-shell/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=http://localhost:4000/document-my-shell/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="http://localhost:4000/assets/js/jquery-1.12.0.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.dlmenu.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.goup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.magnific-popup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.fitvid.min.js"></script> <script src="http://localhost:4000/assets/js/scripts.js"></script> <script type="text/javascript"> var disqus_shortname = 'Evilcrow'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
