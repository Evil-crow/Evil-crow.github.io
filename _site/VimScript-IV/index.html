<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"><!--<![endif]--> <head> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/github.min.css"> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script> <script>hljs.initHighlightingOnLoad();</script> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <title>VimScript的学习(四) &#8211; Road to Coding</title> <meta name="description" content="只要那一抹笑容尚存, 我便心无旁骛"> <meta name="keywords" content="VimScript"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="http://localhost:4000/assets/img/logo.png"> <meta name="twitter:title" content="VimScript的学习(四)"> <meta name="twitter:description" content="现在开始,正式是编程的脚本语言VimScript的学习,以后可是可以开发插件的"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="VimScript的学习(四)"> <meta property="og:description" content="现在开始,正式是编程的脚本语言VimScript的学习,以后可是可以开发插件的"> <meta property="og:url" content="http://localhost:4000/VimScript-IV/"> <meta property="og:site_name" content="Road to Coding"> <meta property="og:image" content="http://localhost:4000/assets/img/logo.png"> <link rel="canonical" href="http://localhost:4000/VimScript-IV/"> <link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Road to Coding Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css"> <!-- JS --> <script src="http://localhost:4000/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="http://localhost:4000/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png" /> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /> <!-- Background Image --> <style type="text/css">body {background-image:url(http://localhost:4000/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="http://localhost:4000/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="http://localhost:4000/assets/img/logo.png" alt="Road to Coding photo" class="author-photo"> <h4>Road to Coding</h4> <p>只要那一抹笑容尚存, 我便心无旁骛</p> </li> <li><a href="http://localhost:4000/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="mailto:evilcrow486@gmail.com" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-envelope-square"></i> Email</a> </li> <li> <a href="http://github.com/Evil-crow" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul><!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="http://localhost:4000/posts/">All Posts</a></li> <li><a href="http://localhost:4000/tags/">All Tags</a></li> </ul> </li> </ul><!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn" style="background-color:rgba(255,255,255,0.97);"> <div class="content"> <div class="post-title "> <h1>VimScript的学习(四)</h1> <h4>19 Oct 2017</h4> <a class="btn zoombtn" href="http://localhost:4000/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <p><em>说在前面</em></p> <p><em>选择VimScript学习,真的是一腔热血,其实这门语言的局限型</em></p> <p><em>比想象中还要小,不只是只能用于Vim插件的开发</em></p> <p><em>而且,是只能跑在Vim平台上的,<code class="highlighter-rouge">:source</code>,执行脚本,以<code class="highlighter-rouge">.vim</code>为文件扩展名</em></p> <p><em>而且,因为小众,历史原因的问题,语法也有点混乱,算是微型PHP</em></p> <p><em>其中有着各种各样的奇奇怪怪的问题,很烦人的</em></p> <p><em>但是,兴趣既是导向,学吧,Fighting!</em></p> <p><strong>也感谢@kang,让我明白.想做就去做</strong></p> <h2 id="关于vimscript">关于VimScript</h2> <p><strong>这是一门将脚本语言 + Vim设置 混搭的语言</strong></p> <p><strong>只能运行在Vim平台上的</strong></p> <p><strong>在Vim中 : source * . vim 即可运行VimScript程序</strong></p> <p>**文件扩展名为 .vim **</p> <p><strong>另外注明 : 在VimScript中进行书写的时候,是不需要 : 的,而含有”:”的都是在Vim中的命令操作</strong></p> <h2 id="变量">变量</h2> <p>VimScript作为一门脚本语言,其中也是可以使用变量的</p> <p>来看一个简单地例子</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:let foo = "bar"
echo foo  #=&gt; "bar"
:let foo = 5
echo foo  #=&gt; 5
</code></pre></div></div> <p>从上面可以看出,VimScript貌似是动态语言,但是,我只能说你太年轻了</p> <p>后面的东西会告诉你,VimScript,<strong>只能算是半动态语言</strong></p> <h3 id="作为变量的选项">作为变量的选项</h3> <p>VimScript是一门用于Vim脚本开发的脚本语言,所以,VimScript中既有脚本语言的内容,同时也嵌套着Vim命令</p> <p>那么,Vim中作为设置选项的,可以作为变量使用吗?</p> <p><strong>答案是肯定的</strong></p> <p>对于作为变量设定的选项,也是可以作为变量使用,同时可以藉此进行选项的修改,利用脚本操作Vim</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:echo &amp;numberwidth
:let &amp;numberwidth=10
:echo &amp;numberwidth
</code></pre></div></div> <p>同时,我们不仅可以设置数值型选项</p> <p>布尔型选项也可以设置</p> <p><strong>truthy = 所有非0值 , false = 0</strong></p> <p>那么为什么要使用let呢?</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:set textwidth=100
:let &amp;numberwidth=&amp;textwidsth-90
:echo &amp;numberwidth
</code></pre></div></div> <p><strong>即可看出,let是可以操作变量的.但是,set是只能操作数值型选项的,不能进行变量值的设定</strong></p> <p><strong>在脚本语言中,使用let是更为方便的</strong></p> <p><strong>但是,更为实际的建议是,能用set的时候就用set,因为let会使语法变得复杂</strong></p> <h3 id="本地选项">本地选项</h3> <p>和之前提到过的进行设置是一样的,变量也是有作用域的,可以进行本地的设置</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:let &amp;l:number = 1
:echo &amp;l:number

切换窗口
:let &amp;1:number = 0
(第一个窗口无效)
</code></pre></div></div> <p>联想之前进行的操作,相信你很容易理解,作为本地选项的含义和意义</p> <h3 id="将变量作为寄存器">将变量作为寄存器</h3> <p>VimScript一个强大的地方在于:<strong>可以将寄存器作为变量使用</strong></p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:let @a = "hello"
:echo @a
</code></pre></div></div> <p>同时,<code class="highlighter-rouge">"ap</code>可以将寄存器中的内容进行粘贴</p> <p>有的寄存器是匿名的,”用来表示没有进行命名的寄存器</p> <p>比如:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo "@
</code></pre></div></div> <p>在文件中选中一个单词并且进行复制,之后再进行输出</p> <p>则这个寄存器就是未命名的</p> <p>可以使用<code class="highlighter-rouge">echo @"</code>进行输出</p> <p><strong>即使用@表明是使用寄存器,之后为寄存器名</strong></p> <p><strong>:help registers中显示了可以使用的寄存器名</strong></p> <h2 id="变量的作用域">变量的作用域</h2> <p><em>了解过Python以及Ruby之后,会大体了解变量作用域的问题</em></p> <p><em>我们再来看看Ruby作用域</em></p> <ul> <li>局部变量</li> <li><strong>$</strong>全局变量</li> <li><strong>@@</strong>类变量</li> <li><strong>@</strong>实例变量</li> </ul> <p><strong>目前,当变量是一个字母与一个冒号开头的时候,它就是一个作用域变量</strong></p> <h2 id="条件语句">条件语句</h2> <p>VimScript中的条件语句,类似于Ruby,但是其中没有<strong>unless</strong></p> <p>if语句的语法为</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if 条件1
  处理1
elseif 条件2
  处理2
else
  处理
endif
</code></pre></div></div> <p>VimScript使用以上语法进行分支操作</p> <p>同时,if语句的判断条件支持表达式expr</p> <p>下来我们来看三个例子:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:echo "hello" + 10
:echo "10hello" + 10
:echo "hello10" + 10
</code></pre></div></div> <p>结果依次是:10,20,10</p> <p>很奇妙,对吗?这就是VimScrript比较恶心的地方了</p> <p><strong>1. 字符串在进行 + 运算时,会强转为数值类型</strong></p> <p><strong>2. 字符串强转时,以数字开头的字符串被强转为数值,否则为’0”</strong></p> <h2 id="比较条件表达式">比较(条件表达式)</h2> <p><strong>比较是很重要的一个东西</strong></p> <p><strong>比较的结果,决定了条件语句,循环语句等等的结果,所以,比较语句是必须的</strong></p> <p><strong>而在VimScript中,比较语句也是十分的恶心</strong></p> <p>VimScript中,比较随处可见的,但是因为与Vim命令混用</p> <p>所以,其中不乏会出现这样的东西:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:set ignorecase              " 设置大小写不敏感
:set noignorecase            " 设置大小写敏感
</code></pre></div></div> <p>而这样,就给我们的比较带来了问题</p> <p><strong>进行字符串的比较时,到底是大写,还是小写,怎么选择?这不就是糊弄人么!</strong></p> <p><strong>所以,VimScript中提供了另外两个比较运算符</strong></p> <p>** ==? 与 ==# 分别表示比较敏感与不敏感**</p> <p><strong>这样的话,就不会出现比较前,需要注意一下,是否被人设置了敏感大小写与否</strong></p> <h2 id="函数function">函数(function)</h2> <p>作为一门编程语言,是一定要支持函数的,没错吧?</p> <p>VimScript中的函数写法是类似于Ruby,Golang的,</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function Hello( )
  echo "This is an function that is used for testing!\n"
  echo "Succeed!\n"
endfunction
call Hello( )
</code></pre></div></div> <p>但是,他是没有Ruby中~ { ~ } ~ 块的写法的</p> <p>其中严格要求使用</p> <p>function ~ endfunction的形式进行函数的定义</p> <p>而且,注意了!</p> <p><strong>VimScript中没有函数作用域型限制的func建议使用大写字母开头</strong></p> <p>上面我们则愉快的定义了一个名为Test的无作用域限制的函数</p> <p>同时,我们在看看这个函数运行的结果</p> <p><img src="http://oww4cv296.bkt.clouddn.com/VimScript%284%29hello%28%29.png" alt="" /> <img src="http://oww4cv296.bkt.clouddn.com/VimScript%284%29hello_result.png" alt="" /></p> <p>此处有一个深坑,就是进行这些函数测试的时候,一般都是写在Vim中的,</p> <p><strong>因为写在.vim文件中,无法进行执行,source文件也并不能直接执行,source只是进行代码的运行</strong></p> <p><strong>即,要使用命令行写,就写到底.或者在.vim文件中直接进行调用,不然在Vim中是不能直接调用的</strong></p> <h3 id="调用函数">调用函数</h3> <p>在VimScript中,调用函数有两种方式,</p> <p><strong>一,使用call 进行函数的调用,但是这个函数只能显示函数的副作用,所以对于没有副作用的函数,无效果</strong></p> <p><strong>二,在表达式中进行函数的调用,不需要使用call,只要是使用函数的名字即可,同时传递函数的返回值</strong></p> <p>举个例子,上面的Hello( )函数</p> <p>可以使用<code class="highlighter-rouge">echom Hello( )</code>调用</p> <p><strong>这会调用Hello( ),并将Hello( )的返回值传递给<code class="highlighter-rouge">echom</code>,但是Hello( )无返回值</strong></p> <h3 id="隐式返回">隐式返回</h3> <p>VimScript中,使用表达式进行函数的调用时,会有<strong>返回值</strong>,对于没有显示设定返回值的函数,会隐式返回0</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function Hello( )
  echo "This is an function that is used for testing!\n"
  echo "Succeed!\n"
endfunction
echom Hello( )
</code></pre></div></div> <p><img src="http://oww4cv296.bkt.clouddn.com/VimScript%284%29_shadow_value.png" alt="" /> 例如,上面的代码执行后,会有一行为0</p> <p>而进行这样的修改后</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function Hello( )
  echo "This is an function that is used for testing!\n"
  echo "Succeed!\n"

  return "Return_Value"
endfunction
echom Hello( )
</code></pre></div></div> <p><img src="http://oww4cv296.bkt.clouddn.com/VimScript%284%29_result.png" alt="" /></p> <p>如果有C语言的编程经验,对于返回值的问题还是比较容易理解的</p> <p><strong>如果VimScript函数不返回一个值,则它会隐式返回0</strong></p> <h3 id="函数参数">函数参数</h3> <p>作为编程语言中的函数,<strong>一定是可以接受参数的</strong></p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>funcation DisplayName(name)
  echo "hello,my name is"
  echo a:name
endfunction
call DisplayName("Crow")
</code></pre></div></div> <p>即可将字符串传入函数DisplayName(name)中,从而显示输入的字符串</p> <p><strong>谨记:name在该函数中,是具有函数作用域的.所以,我们需要在前面加上 a: 来进行变量作用域的限制</strong></p> <p><strong>如果,没有作用域限制,会变成全局作用域,VimScript会报错,无法找到变量</strong></p> <p><strong>所以,在写需要变量的VimScript函数时,请总在变量前加上<code class="highlighter-rouge">a:</code>来显示变量的作用域</strong></p> <h3 id="可变参数">可变参数</h3> <p>有的时候,不想规定参数个数,根据需要进行参数个数限定</p> <p>可以使用可变参数进行函数的设计</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function! Varg(...)
  echo a:0
  echo a:1
  echo b:2
  echo a:000
endfunction
call Varg(1,2)
</code></pre></div></div> <p><strong>首先注意一点,我们从这里开始使用<code class="highlighter-rouge">function!</code>来进行函数的定义,为什么?</strong></p> <p><strong>使用function! 可以覆盖之前进行加载过的函数,对于重名函数进行覆盖,所以,建议加上 ! 更为安全</strong></p> <p><strong>否则,有时对于重名函数会进行报错,同时也建议使用 ! 的时候,不要使用重名函数,会进行覆盖.</strong></p> <p>现在,我们来看看可变参数如何使用</p> <p><strong>echo a:0 显示了可变参数的个数</strong></p> <p><strong>echo a:1 显示了第一个参数</strong></p> <p><strong>echo a:2 显示了第二个参数</strong></p> <p><strong>echo a:000 则将可变参数转换成为列表</strong></p> <p><strong>列表,同Python的列表,Ruby的数组</strong></p> <p>同时,我们还可以将可变参数与普通参数一起使用,可以写出下面这样的函数</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function! A(a,...)
  echo a:a
  echo a:0
  echo a:1
  echo a:000
endfunction
call A("Crow",1)
</code></pre></div></div> <p><img src="http://oww4cv296.bkt.clouddn.com/VimScript%284%29_varg.png" alt="" /></p> <p>VimScript会自行进行判断,处理好可变参数和具名参数的赋值</p> <h2 id="循环">循环</h2> <p>三(四)大语句中,循环可是占了不小的分量.</p> <p>但是,为什么不进行循环的介绍呢?</p> <p>因为VimScript中,对于循环的需求是很小的,但是还是有了解的必要</p> <p><strong>循环有:for循环,2 while循环两种</strong></p> <h3 id="for循环">for循环</h3> <p>类似于Ruby中的for循环,从C转换过来,可能不是很适应</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>let foo = [1,2,3,4,5]
for i in foo do
  echo i
endfor
</code></pre></div></div> <p>上面的循环,逐次遍历输出foo列表中的元素</p> <h3 id="while循环">while循环</h3> <p>while的循环是与其他语言大同小异的</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>let foo = [1,2,3]
let i = 0
while i &lt;= 2
  echo foo[i]
  let i = i + 1
endwhile
</code></pre></div></div> <p><strong>需要注意,endwhile,endfunction,endfor不能写错</strong></p> <p><strong>同时,对于进行值改变时,一定要加上let,进行操作</strong></p> <hr /> <p>最后,来谈谈echo与echom的区别吧</p> <p>echo系的的函数有很多,的那是我们常用的就是echo与echom</p> <p>其区别在于:</p> <p><strong>echo: 会将结果进行结算,并且显示完后结束</strong></p> <p><strong>echom: 将内容作为一个真正的消息进行显示并存储,所有消息必须时数值/字符串</strong></p> <p><strong>列表,字典,浮点数这些都是不被允许的</strong></p> <p>一般情况下,如果不是为了进行消息的存储,**建议使用 echo **</p> <p>October 24, 2017 10:11 PM</p> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="http://localhost:4000/tags/#VimScript" title="Pages tagged VimScript" class="tag"><span class="term">VimScript</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/VimScript-IV/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/VimScript-IV/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=http://localhost:4000/VimScript-IV/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="http://localhost:4000/assets/js/jquery-1.12.0.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.dlmenu.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.goup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.magnific-popup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.fitvid.min.js"></script> <script src="http://localhost:4000/assets/js/scripts.js"></script> <script type="text/javascript"> var disqus_shortname = 'Evilcrow'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
