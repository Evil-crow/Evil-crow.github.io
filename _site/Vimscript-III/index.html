<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"><!--<![endif]--> <head> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/github.min.css"> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script> <script>hljs.initHighlightingOnLoad();</script> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <title>VimScript的学习(三) &#8211; Road to Coding</title> <meta name="description" content="只要那一抹笑容尚存, 我便心无旁骛"> <meta name="keywords" content="VimScript"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="http://localhost:4000/assets/img/logo.png"> <meta name="twitter:title" content="VimScript的学习(三)"> <meta name="twitter:description" content="这一篇是关于配置篇的最后一篇了"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="VimScript的学习(三)"> <meta property="og:description" content="这一篇是关于配置篇的最后一篇了"> <meta property="og:url" content="http://localhost:4000/Vimscript-III/"> <meta property="og:site_name" content="Road to Coding"> <meta property="og:image" content="http://localhost:4000/assets/img/logo.png"> <link rel="canonical" href="http://localhost:4000/Vimscript-III/"> <link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Road to Coding Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css"> <!-- JS --> <script src="http://localhost:4000/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="http://localhost:4000/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png" /> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /> <!-- Background Image --> <style type="text/css">body {background-image:url(http://localhost:4000/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="http://localhost:4000/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="http://localhost:4000/assets/img/logo.png" alt="Road to Coding photo" class="author-photo"> <h4>Road to Coding</h4> <p>只要那一抹笑容尚存, 我便心无旁骛</p> </li> <li><a href="http://localhost:4000/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="mailto:evilcrow486@gmail.com" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-envelope-square"></i> Email</a> </li> <li> <a href="http://github.com/Evil-crow" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul><!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="http://localhost:4000/posts/">All Posts</a></li> <li><a href="http://localhost:4000/tags/">All Tags</a></li> </ul> </li> </ul><!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn" style="background-color:rgba(255,255,255,0.97);"> <div class="content"> <div class="post-title "> <h1>VimScript的学习(三)</h1> <h4>18 Oct 2017</h4> <a class="btn zoombtn" href="http://localhost:4000/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <h2 id="自动命令组">自动命令组</h2> <p>VimScript中多次使用自动命令,会进行重载,</p> <p>并且将命令进行多次使用,叠加,会严重影响Vim的速度</p> <p>所以,使用自动命令组,进行合理配置</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>augroup testgroup
  autocmd BufWrite * :echom "hello"
  autocmd BufWrite * :echom "Vim"
augroup END
</code></pre></div></div> <p>但是,使用自动命令组,还是会进行命令的叠加</p> <p>肯定有办法解决</p> <p>使用 autocmd! 清除自动命令组</p> <p><strong>可以避免进行自动命令组的重载</strong></p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>augroup testgroup
  autocmd!
  autocmd BufWrite * :echom "hello"
  autocmd BufWrite * :echom "Vim"
augroup END
</code></pre></div></div> <p>这样可以定义多组自动命令,且不会重复加载</p> <h2 id="opearate-pending">Opearate-Pending</h2> <p>mapping 是我们之前提到过,VimScript功能强大的一个很重要的原因</p> <p>之前提到了,<code class="highlighter-rouge">map</code>,<code class="highlighter-rouge">imap</code>,<code class="highlighter-rouge">vmap</code>,<code class="highlighter-rouge">nmap</code> 以及用<code class="highlighter-rouge">nore</code>表示非递归</p> <p>但是,还有一种十分重要的mapping</p> <p><strong>Operate-Pending</strong> 表示<strong>在一个操作之后,跟着进行移动的命令,</strong></p> <p><strong>此操作会从开始的位置,一直到移动结束的位置为止</strong></p> <p>常用的操作符及常见的移动命令</p> <table> <thead> <tr> <th>按键</th> <th>操作</th> <th>移动</th> </tr> </thead> <tbody> <tr> <td>dw</td> <td>删除</td> <td>直到下一个单词</td> </tr> <tr> <td>ci(</td> <td>修改</td> <td>在括号内</td> </tr> <tr> <td>yt,</td> <td>复制</td> <td>到逗号</td> </tr> </tbody> </table> <p>这一部分,我们要进行的不是修改操作的映射,而是修改移动的映射</p> <p>即<strong>Movement的映射</strong></p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:onoremap p i(
</code></pre></div></div> <p>即将p键映射到在括号内修改</p> <p>再来看一个例子</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:onoremap b /return&lt;cr&gt;
</code></pre></div></div> <p>b键现在映射为,搜索到的所有的return</p> <p>例如执行<code class="highlighter-rouge">db</code> 则会删除所有的<code class="highlighter-rouge">return</code></p> <p>当然,Vim这种可定制化程度高的编辑器</p> <p>一定是可以<strong>修改光标开始的位置</strong></p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:onoremap in( :&lt;c-u&gt;normal! f(vi(&lt;cr&gt;
</code></pre></div></div> <p>将<code class="highlighter-rouge">in(</code>映射为,<code class="highlighter-rouge">f(vi(&lt;cr&gt;</code></p> <p><strong>其中的&lt; c-u &gt;与normal!,会在之后解释,但是目前与映射的功能无关</strong></p> <p><strong>f( -&gt; 向下寻找并移动到括号</strong></p> <p><strong>v i ( 进入可视化模式,并且选中括号内所有内容</strong></p> <p>所以,这条映射的作用是,向下寻找并且选中括号内所有内容</p> <p>同理,向上寻找为:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:onoremap il( :&lt;c-u&gt;normal! F)vi(&lt;cr&gt;
</code></pre></div></div> <p>这两个命令,可以理解为<code class="highlighter-rouge">i(</code>的强化与拓展</p> <p>一般规则如下,可以更清晰的明白如何进行<strong>Operate-Pending</strong>如何工作</p> <p><strong>1. 如果你的Operator-pending映射在可视化模式下选中文本结束,Vim会操纵这些文本</strong></p> <p><strong>2. 否则Vim会操作从光标的原始位置到一个新位置的文本</strong></p> <h2 id="更多强大的operator-pending映射">更多,强大的Operator-Pending映射</h2> <p>现在开始,我们进行更为强大的Vim的映射</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:onoremap ih :&lt;c-u&gt;excuate "normal! ?^==\\+$\r:nohlsearch\rkvg_"&lt;cr&gt;
</code></pre></div></div> <p>第一眼看上去,这个映射也使我头大,那么有什么办法呢?</p> <p>继续进行拆分</p> <p><strong>excuate 表示执行后面作为Vim脚本字符串部分的命令</strong></p> <p><strong>那么,excuate,normal!都可以表示执行,有什么区别,</strong></p> <p><strong>实质上,normal!,是不能识别转义字符的,反之excuate是可以的</strong></p> <p><strong>当excuate遇到想要执行的脚本字符串的时候,首先会替换特殊字符</strong></p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"noamal! ?^== \ +$ &lt;换行&gt; :nohlsearch &lt;换行&gt; kvg_" &lt;cr&gt;
</code></pre></div></div> <p><strong>?^==+$,表示搜索任何以2个以上== ,且只有’=’的行,并且切换到行首</strong></p> <p><strong>:nohlserach,取消搜索的语法高亮</strong></p> <p><strong>kvg_ ,移动到上一行,可视化模式,移动到本行最后一个非空字符上,不使用$,是因为不需要选中’\0’</strong></p> <p><strong>这一个Operate-Pending的作用就是选中,向后的一个,标题行</strong></p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:onoremap an :&lt;c-u&gt;execute "normal! ?^==\\+\r:nohlserach\rg_vk0"&lt;cr&gt;
</code></pre></div></div> <p>相比与上一条,改变之处在于:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\rg_vk0"&lt;cr&gt;
</code></pre></div></div> <p>选中到最后一个非空字符,之后进入可视化模式,向上移动一行,再将光标移动至行首,</p> <p><strong>实现了选中,上下两行的功能</strong></p> <h2 id="状态条">状态条</h2> <p>平时经常看见,下面的状态条,那么,这也能定制化吗? ? ?</p> <p><strong>当然可以</strong></p> <p>使用<code class="highlighter-rouge">statusline</code>来进行定制</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:set statusline=%f   查看编辑路径
:set statusline=%f\ - \ FileType:\ %y
</code></pre></div></div> <p>VimScript在此处,空格需要进行转义</p> <p>这其中的格式化字符串,是类似于C以及Python的</p> <p>但是,上面那样的写法,可读性是十分垃圾的,所以我们建议:</p> <p><strong>使用叠加的方式来写</strong></p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:set statusline=%f          " 文件名即及路径
:set statusline+=\ -\       " 空格
:set statusline+=FileType:  " 标签
:set statusline+=%y         " 类型名
</code></pre></div></div> <p>statusline的设定可以使用各式各样的,修饰符,如何操作,由使用者自行决定</p> <h2 id="负责任的编码">负责任的编码</h2> <p>VimScript作为一门十分小众的语言,但是他也存在程序员必须遵守的编程准则</p> <p><strong>注释</strong></p> <p><strong>分组</strong></p> <p><em>使用其中的代码折叠功能,使得你的配置可以清晰的展现出来</em></p> <p><strong>简写</strong></p> <p><strong>强烈要求:不要使用简写,会使你的代码混乱不堪</strong></p> <p><strong>至此,第一部分进行Vimrc的基础配置到此结束,下面开始,会将VimScript作为一门真正的编程语言来学习</strong></p> <p>October 19, 2017 2:31 AM</p> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="http://localhost:4000/tags/#VimScript" title="Pages tagged VimScript" class="tag"><span class="term">VimScript</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/Vimscript-III/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/Vimscript-III/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=http://localhost:4000/Vimscript-III/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="http://localhost:4000/assets/js/jquery-1.12.0.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.dlmenu.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.goup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.magnific-popup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.fitvid.min.js"></script> <script src="http://localhost:4000/assets/js/scripts.js"></script> <script type="text/javascript"> var disqus_shortname = 'Evilcrow'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
