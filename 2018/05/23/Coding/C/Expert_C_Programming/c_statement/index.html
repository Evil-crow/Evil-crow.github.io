<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>&lt;咸鱼书&gt; C声明问题 | Road to Coding</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">&lt;咸鱼书&gt; C声明问题</h1><a id="logo" href="/.">Road to Coding</a><p class="description">只要那一抹笑容尚存，我便心无旁骛。</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">&lt;咸鱼书&gt; C声明问题</h1><div class="post-meta">May 23, 2018<span> | </span><span class="category"><a href="/categories/C-C/">C/C++</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#如果有人说-函数参数从右向左压入堆栈-那你就去把他头打烂"><span class="toc-number">1.</span> <span class="toc-text">如果有人说,函数参数从右向左压入堆栈,那你就去把他头打烂</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#聊一聊联合的那点事-union"><span class="toc-number">2.</span> <span class="toc-text">聊一聊联合的那点事(union)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#关于枚举-enum"><span class="toc-number">3.</span> <span class="toc-text">关于枚举(enum)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#typedef的前身后事"><span class="toc-number">4.</span> <span class="toc-text">typedef的前身后事</span></a></li></ol></div></div><div class="post-content"><p><em>既然是要撕C语言的声明,那么我们就直接一点吧</em></p>
<p>但是,开始之前先说说其他的:闲聊</p>
<h3 id="如果有人说-函数参数从右向左压入堆栈-那你就去把他头打烂"><a href="#如果有人说-函数参数从右向左压入堆栈-那你就去把他头打烂" class="headerlink" title="如果有人说,函数参数从右向左压入堆栈,那你就去把他头打烂"></a>如果有人说,函数参数从右向左压入堆栈,那你就去把他头打烂</h3><p> 参数传递进入函数时,不是一定都在堆栈区的,int型这类数据,是可以进入resigter的,</p>
<p> 而形如结构这样的,是进入堆栈区的,所以说参数传递首先进入寄存器,不是无脑进入堆栈区的</p>
<h3 id="聊一聊联合的那点事-union"><a href="#聊一聊联合的那点事-union" class="headerlink" title="聊一聊联合的那点事(union)"></a>聊一聊联合的那点事(union)</h3><p> 联合一般是用在结构体内部,用来进行节省空间的,因为Union中的数据是不可能同时出现的</p>
<p> 也就是说,union中的数据都是互斥的.联合可以将一个东西解释为两种含义,比如:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">union</span> test &#123;</span><br><span class="line">    <span class="keyword">char</span> a;</span><br><span class="line">	<span class="keyword">int</span> b;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_edian</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">union</span> test temp;</span><br><span class="line">	temp.b = <span class="number">0x12345678</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%d"</span>, temp.a); <span class="comment">// 12 Big-endian, 78 little-endian</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="关于枚举-enum"><a href="#关于枚举-enum" class="headerlink" title="关于枚举(enum)"></a>关于枚举(enum)</h3><p>枚举,其实平时用的是比较少的,但是enum还是有它的好处,#define经常与他混用</p>
<p>Linux Kernel 2.6X时,伙伴算法中的flags标志位使用#define, 整整15个</p>
<p>Linux Kernel 3.x后,全部修改为枚举变量,无中生有吗?</p>
<p>并不是,是因为枚举相对于#define有这样一个巨大的好处:</p>
<p>#define在预编译阶段结束之后,便丢弃.而枚举依然能够保存在符号表中,之后方便调试</p>
<p>也即是说,#define就在符号表中找不到了,这样就简单了</p>
<p>C声明的那点事</p>
<p>下面进入我们的正题,如何来看C语言的声明优先级</p>
<p>首先看看这张图:</p>
<p><img src="http://p8pmsq2a4.bkt.clouddn.com/C_statement.png" alt="如何解析C语言声明"> </p>
<p>神图!,我来给大家解释一下.</p>
<ol>
<li><p>从标识符看起</p>
</li>
<li><p>首先向右看,如果是方括号,则为数组.如果是括号,就是函数,再去看参数(方括与括号不可能同级出现)</p>
</li>
<li><p>之后向左看,如果是一个左括号,则此部分声明已经被组合到一起,去找此括号,对应的右括号</p>
</li>
<li><p>之后回到第2步,继续</p>
</li>
<li><p>再次到第3步,如果是const, volatile *之一,就重复继续看是否有左括号</p>
</li>
<li><p>直到最后,遇到基本类型可以一次读完.</p>
</li>
</ol>
<p>光说不练假把式,来分析三个实例:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> * <span class="keyword">const</span> *(*next)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> *(* c[<span class="number">10</span>])(<span class="keyword">int</span> **p);</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> (*signal(<span class="keyword">int</span> sig, <span class="keyword">void</span>(*func)(<span class="keyword">int</span>)))(<span class="keyword">int</span>);</span><br></pre></td></tr></table></figure>
<p>第一个实例:<br>-&gt; 标识符为next -&gt; 右看没有 -&gt; 左看是”*” -&gt; 得到: next时一个指针,指向XXX</p>
<p>-&gt; 左看是左括号,找到匹配右括号,之后向右看,括号,即为函数,所以next是一个函数指针</p>
<p>-&gt; 左看,*, 指向…的指针 -&gt; 继续, 只读属性 -&gt; 继续, 指向…的指针 -&gt; 继续, char类型,结束</p>
<p>#=&gt; 得到结果: next是一个函数指针, 他指向一个参数为void, 返回值是指向只读字符串的指针</p>
<p>第二个实例:</p>
<p>-&gt; 标识符为c</p>
<p>-&gt; 右看,[],c是一个数组</p>
<p>-&gt; 右括号,向左看, *,则数组元素为指针,c[10]里面存了, 10个 指向XXX的指针</p>
<p>-&gt; 出来,向右看,括号,函数,参数就那样,结束</p>
<p>-&gt; 向左看, char * 为返回值</p>
<p>#=&gt; 得到结果: c是一个数组,里面放了10个指针,10个指针指向了函数,char (*)(int **)类型 c即为函数指针数组</p>
<p>第三个实例:</p>
<p>-&gt; 标识符为signal,右看( ),即为函数</p>
<p>-&gt; 函数参数为(…int及函数指针)</p>
<p>-&gt; 右括号, 则向左看, *,为signal函数的返回值,是一个指针</p>
<p>-&gt; 指针指向void (*)(int)</p>
<p>这个就比较复杂,但是我们可以这样:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*pfn)</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">signal #=&gt; pfn signal(<span class="keyword">int</span>, pfn);</span><br></pre></td></tr></table></figure>
<p> 从这里我们就可以看出,我们使用typedef可以将函数指针类型左为返回值剥离出来</p>
<p> C这种类似于递归理解的声明语法确是看的人眼花缭乱,一切还是因为他晦涩的语法的原因</p>
<h3 id="typedef的前身后事"><a href="#typedef的前身后事" class="headerlink" title="typedef的前身后事"></a>typedef的前身后事</h3><p>既然这样,我们就再来说说typedef: typedef原名存储类型说明符</p>
<p>他常用的地方在于: 对已存在数据类型进行重新命名(别名), 方便大型程序的开发</p>
<p>用法: 像平常的变量声明一般,加上typedef即可.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> a;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*pd)</span><span class="params">(<span class="keyword">int</span>)</span></span></span><br></pre></td></tr></table></figure>
<p>即可完成,当然了,需要加上分号( ; )</p>
<p>同一个代码块中,typedef不能引入和其他标识符重名的名字</p>
<p>typedef有两个重要的问题:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="keyword">typedef</span> <span class="keyword">int</span> *ptr, (*fun)(), arr[<span class="number">5</span>];  <span class="comment">//分别为int指针, int(*)()函数指针, size=5的int数组</span></span><br><span class="line"><span class="number">2.</span> <span class="keyword">unsigned</span> <span class="keyword">const</span> <span class="keyword">long</span> <span class="keyword">typedef</span> <span class="keyword">int</span> <span class="keyword">volatile</span> *kumquat; <span class="comment">// 不要在中间使用&lt;/span&gt;</span></span><br></pre></td></tr></table></figure>
<p>至于typedef与#define的区别:</p>
<p>1.mtypedef是彻底的”封装”, 可以使用#define进行类型扩展, typedef无效</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">char</span> * cstring;</span><br><span class="line">define <span class="keyword">char</span> * CSTRING</span><br><span class="line"><span class="keyword">const</span> cstring str;   <span class="comment">//error</span></span><br><span class="line"><span class="keyword">const</span> CSTRING STR;   <span class="comment">// correct</span></span><br></pre></td></tr></table></figure>
<p>2.连续几个变量声明,typedef可保证变量类型一致性,#define无法保证</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">define INT_PTR <span class="keyword">int</span> *</span><br><span class="line">INT_PTR a, b;    #=&gt; a = <span class="keyword">int</span> *, b = <span class="keyword">int</span> </span><br><span class="line"><span class="keyword">typedef</span> int_ptr <span class="keyword">int</span> *;</span><br><span class="line">int_ptr c, d;       #=&gt; a = <span class="keyword">int</span> *, b = <span class="keyword">int</span> *</span><br></pre></td></tr></table></figure>
<p>C声明是个恶心的东西,到了C++也不一定能够完全跳脱, 但是多理解,配上typedef,可以事半功倍</p>
<hr>
<p>update: </p>
<p>另外我要喷一下垃圾js,劳资这篇文档就是因为它的评论系统搞死了,</p>
<p>让我从git commit中把HTML改回来,累死我了,靠!</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="http://evil-crow.github.io/2018/05/23/Coding/C/Expert_C_Programming/c_statement/" data-id="cjofmnvz8006l2knrwc9lo6n6" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACtUlEQVR42u3aUU4kMQwE0Ln/peEASw9VdgKs9PprJJpMXpDiUM7rFT8f/zzJO/n7yXc9jXPgwcPDw1tP/Wnop6lslma2EMVS4uHh4V3jPQ2afE5++h6QM/I54+Hh4f0dXv0FbzH5+Hh4eHj/L6+lzuKG5Kd4eHh4v8tLwog8aGiDgzzUuJi14OHh4XXdqOHx97c+X+nv4eHh4a276vmmPxs5j3GHs8XDw8O7wJu1/2eNrtnxd3bsxsPDw7vHSy5XvZ9o3rLaLFkSSXzxDh4eHt41XvtryaLMMEl5SBY6SlDw8PDwRrz3k87b+Zujdrt89fh4eHh4R3l5S6mNU5ND9iySKN7Bw8PDu8Zro4dZY6x9My9CUX8PDw8P7xCvDQ7aQ207uaJrtygzeHh4eBveLBoYtqPip12+x2XFw8PDu8xrY4V8628P3LMlOLBOeHh4eGlfvr5GkONnl7TyawTFRQQ8PDy8C7zNP/95nHrq2lYR2uLh4eEd5bWtr/ZQnm/Zs/eLGBcPDw/vEK9tgO3bWm3VSpaj/ZPg4eHhneK1U5ldjUqO7O3IUbsODw8P7xBvmFWUjagkRGij4ahU4OHh4V3jtYfpTQDRloT28P1FYcDDw8M7ymunmEe9yba+KQPJ/o+Hh4d3j5c0tPIAYtiUGoHrb8TDw8M7xGsPrJs4o722lUcbr3bqeHh4eNd4SRnIm1Kz0Q509vDw8PCu8fICkG/i7ZF9E0ng4eHh3eZ9lM+BIDW+ZFC0uJ5GwMPDw7vA22y7bTBxKhTelxA8PDy8PS+PDGYbdH5kTz7XlxXw8PDwrvHyRn4eIswijLMFDA8PD+8v8BLwfnKzQnWgMODh4eFd4LUXAtroYfa9eHh4eD/PO3X5aRYitMiiMYaHh4d3gZcfdmdbfF48No23AxkGHh4e3ve8T4Whu2Ck5My/AAAAAElFTkSuQmCC">分享</a><div class="tags"><a href="/tags/Expert-C-Programming/">Expert_C_Programming</a></div><div class="post-nav"><a class="pre" href="/2018/05/27/Guide/Binutils/size/">Binutils の size</a><a class="next" href="/2018/05/23/Coding/C/Expert_C_Programming/little_thing_of_C/">&lt;咸鱼书&gt; C中的一些小细节</a></div><div id="container"></div><link rel="stylesheet" href="/css/default.css?v=0.0.0"><script src="/js/gitment.browser.js?v=0.0.0"></script><script>var gitment = new Gitment({
  owner: 'evil-crow',
  repo: 'evil-crow.github.io',
  oauth: {
    client_id: '1c81bedb1f161c78ec76',
    client_secret: '29bf11687745096e8640698a23483cb6c643d944',
  },
})
gitment.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Assembly/">Assembly</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Bible/">Bible</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/C-C/">C/C++</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Documents/">Documents</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Guide/">Guide</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Q-A/">Q&A</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby/">Ruby</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SQL/">SQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ShellScript/">ShellScript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Unix-Linux/">Unix/Linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Unix-Linux/Guide/">Guide</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Vim/">Vim</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Syscall/" style="font-size: 15px;">Syscall</a> <a href="/tags/CodeStyle/" style="font-size: 15px;">CodeStyle</a> <a href="/tags/CSAPP/" style="font-size: 15px;">CSAPP</a> <a href="/tags/EffectiveC/" style="font-size: 15px;">EffectiveC++</a> <a href="/tags/EffectiveSTL/" style="font-size: 15px;">EffectiveSTL</a> <a href="/tags/ShellScript/" style="font-size: 15px;">ShellScript</a> <a href="/tags/Ruby/" style="font-size: 15px;">Ruby</a> <a href="/tags/VimScript/" style="font-size: 15px;">VimScript</a> <a href="/tags/Assembly/" style="font-size: 15px;">Assembly</a> <a href="/tags/Binuntils/" style="font-size: 15px;">Binuntils</a> <a href="/tags/GDB/" style="font-size: 15px;">GDB</a> <a href="/tags/vbird/" style="font-size: 15px;">vbird</a> <a href="/tags/RegExpression/" style="font-size: 15px;">RegExpression</a> <a href="/tags/LinuxC/" style="font-size: 15px;">LinuxC</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/Expert-C-Programming/" style="font-size: 15px;">Expert_C_Programming</a> <a href="/tags/CTrapsAndPitfalls/" style="font-size: 15px;">CTrapsAndPitfalls</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/11/08/Coding/EffSTL/stl1/"><STL> Containers</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/09/Coding/EffC++/effective5/"><星月夜> Implementations</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/27/Coding/C/Expert_C_Programming/data_mem/"><咸鱼书> 运行时数据结构与内存</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/26/Coding/EffC++/effective4/"><星月夜> Designs and Declarations</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/19/Coding/EffC++/effective3/"><星月夜> Resource Management</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/13/Coding/EffC++/effective2/"><星月夜> Constructors, Destructors, and Assignment Operators</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/07/Coding/EffC++/effective1/"><星月夜> Accustoming Yourself to C++</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/08/Guide/GDB/multprocess/">GDB调试系列(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/31/Guide/Fedora_KDE/">Linux的常用配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/28/Question_Answer/C/two_level_array/">一个C语言指针的问题让我翻车</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Road to Coding.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>